<script setup>
import CodeBlock from '/docs/components/CodeBlock.vue'
</script>

# JWT with Amazon Cognito

We use Amazon Cognito as our Identity Provider `IdP`.  An IdP is a service that holds and authenticates you via your username and password. Or in the case of a Single-Sign-On `SSO`, your information (`ID`) 🪪 is simply `federated` from your corporate system to Cognito to our System, without us ever accessing sensitive data.  

We use Cognito to keep your credentials as secure 🔐 as possible.  Our system never "touches" 👈 or "sees" 👀 your password.  We do know your username (email address) and a cognito-generated `ID`, which is how we link your account to analysis executions, files, etc.  

During your onboarding process, you should have received a username and password which was generated by Amazon Cognito.  Those two values along with a `Client Id` will allow you programmatic access to the Aplos NCA Analysis SaaS system.  

> [!TIP]
> Don't worry, you can't do anything bad, and everything you do is locked to your user identity, your tenancy and your account.


## SSO Single-Sign-On Support
As mentioned in the intro, Cognito can be integrated with your federated `IdP` Single-Sign-On `SSO`.  If you require `SSO` please reach out to our support team.  

> [!NOTE]
> Using SSO will require an a team or enterprise account and some lead time for set up.  You can always start without SSO and upgrade later.


## Obtaining a JWT

JWTs can be obtained via using standard username/password flow (`ALLOW_USER_PASSWORD_AUTH`),  Secure Remote Password flow (`ALLOW_USER_SRP_AUTH`) or via a `client id` and `client secret` which is typically used for automated solutions.

Whichever method you use it's important to keep these values confidential.

## Connecting to Amazon Cognito

No matter what tool you use (Java, Python, c#, R, Ruby, PHP, curl, etc), connections to Amazon Cognito are essentially HTTPS calls.

To keep it simple here is an example using `curl` in shell command.  If you're not used to using shell commands or `curl`, that's ok. We'll try to make it as straightforward as possible and explain it along the way.

We also have examples using Python, R and SAS.
<!-- ToDo add the links to the examples for each language we have samples for -->

When you look at the following script, notice there are only three values that you need to provide, for the rest of the script you can use "as-is".

|Name|Value|Description|
|--|--|--|
|COGNITO_USER_NAME|Your username| your email address |
|COGNITO_PASSWORD|Your password |provided during onboarding  |
|COGNITO_CLIENT_ID|Your cognito client id |Available in your profile settings|

> [!TIP]
> `curl` is a shell command that allows you to make web (http/https) requests in the command line.  It's simple and easy to use.
>
> In the example below, the `payload` refers to the body of an HTTPS request. It is included in the `body/data` of the web request, which ensures that it is transmitted securely and encrypted. The request uses `HTTPS` which automatically handles the encryption and decryption of data, similar to how your browser secures data when you're online.
>
> The `header` information required here, is supplied by AWS and you can find more detail in their documentation.
>
> The `flow` of this process extracts environment variables into local variables called: `username`, `password` and `client_id` and then adds them to the payload and makes a `curl` https request to get retrieve your token.  The outputs it into your shell.

## Shell Script Example
<CodeBlock src="https://raw.githubusercontent.com/AplosAnalytics/docs.aplosanalytics.com/develop/docs/samples/shell/login/amazon-cognito-jwt.sh" lang="shell"></CodeBlock>


Given the code above you and if you saved it in a file named `amazon-cognito-jwt.sh`, you can execute the following:



<CodeBlock src="https://raw.githubusercontent.com/AplosAnalytics/docs.aplosanalytics.com/develop/docs/samples/shell/login/login_example.sh" lang="shell"></CodeBlock>

## The Response
The output won't be as clean as the output below, but you'll get back something like the following:

> [!NOTE]
> **This was a real response from a temp account I created.  I removed the RefreshToken for safety as it's a long-lived token.  We're serious about security so that account has also been disabled and is scheduled for destruction.**
<CodeBlock src="https://raw.githubusercontent.com/AplosAnalytics/docs.aplosanalytics.com/develop/docs/samples/jwt/cognito-response-payload.json" lang="shell"></CodeBlock>


## Next Steps
Now that you have a token, you can make calls to the Aplos NCA SaaS system.  This is of course assuming your account is valid ✅, your subscription is active 🎉 and finally, you have the correct permissions 🔓 (whew) 🥵 : you can make calls against our APIs 🚀.